<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>图书馆交叉分析</title>
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style1.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="custom1.min.css" rel="stylesheet">
    <script src="../libraryreport/template.js"></script>
</head>
<body>
<div class="page chapter" style="height: auto; width: 80%;">
    <div style="width: 95%; margin: 0 auto; display:flex; display: -webkit-flex; align-items:center;">
        <span style="font-size: 25px; font-weight: bold;">当前显示</span>
        <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span id="YearChosen"></span><span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="#"><span id="Year1"></span></a></li>
                <li><a href="#"><span id="Year2"></span></a></li>
                <li><a href="#"><span id="Year3"></span></a></li>
                <li><a href="#"><span id="Year4"></span></a></li>
            </ul>
        </div>
        <span style="font-size: 25px; font-weight: bold;">年图书馆交叉分析</span>
    </div>
</div>
<div class="page chapter" id="CrossAnalysisByDay" style="height: auto; width: 80%">
    <div class="second-title" style="font-size:25px;">图书馆各时段情况统计分析
        <!--<a href=\"CrossAnalysis.html\" style="text-decoration: underline"> 2017 </a>-->
        <!--&nbsp <a href=\"CrossAnalysis.html\" style="text-decoration: underline"> 2016 </a>-->
        <!--&nbsp <a href=\"CrossAnalysis.html\" style="text-decoration: underline"> 2015 </a>-->
        <!--&nbsp <a href=\"CrossAnalysis.html\" style="text-decoration: underline"> 2014 </a></div>-->
    </div>
    <div class="pagination" style="bottom: 30px"></div>
</div>

<div class="page chapter" id="CrossAnalysisByMonth" style="height: auto; width: 80%">
    <div class="second-title" style="font-size:25px">图书馆每月情况统计分析</div>
    <div class="pagination" style="bottom: 30px"></div>
</div>

<div class="page chapter" id="UtilizationAnalysis" style="height: auto ; width: 80%">
    <div class="second-title" style="font-size:25px" >图书馆资源使用分析</div>
    <div class="pagination" style="bottom: 30px"></div>
</div>

<div class="page chapter" id="crossAnalysisByMonthOfUnderGraduate" style="height: auto; width: 80%">
    <div class="second-title" style="font-size:25px">各学院本科生2017年度分析</div>
    <div class="pagination" style="bottom: 30px"></div>
</div>

<div class="page chapter" id="crossAnalysisByMonthOfGraduate" style="height: auto; width: 80%">
    <div class="second-title" style="font-size:25px">各学院研究生2017年度分析</div>
    <div class="pagination" style="bottom: 30px"></div>
</div>

<script language="javascript" type="application/javascript">
    $(function(){
        CrossAnalysisByDay();
        getCrossAnalysisUtilizationRatio();
        getCrossAnalysisByMonth();
        getCrossAnalysisByAcademyInUnderGraduate();
        getCrossAnalysisByAcademyInGraduate();
        initYearSelection(); //初始化年份选择下拉框
    })
</script>
<script type="application/javascript">
    function CrossAnalysisByDay() {
        $.get('../../cross_analysis/CrossAnalysisByDay', function (data) {
            // console.log(data);
            if(!$("#CrossAnalysisByDay").find(".temp").length > 0) {
                $("#CrossAnalysisByDay").append("<div class='table temp'></div>");
            }
            var html = template('CrossAnalysis1', {param: data});//
            $("#CrossAnalysisByDay").find(".temp" ).html(html);
        });
    }
</script>

<script type="application/javascript">
    function getCrossAnalysisUtilizationRatio() {
        $.get('../../cross_analysis/getCrossAnalysisUtilizationRatio', function (data) {
            // console.log(data);
            var result = [];
            for(var i = 0; i < data.ic_type.length; i++) {
                var temp = new Object();
                temp.ic_type = data.ic_type[i];
                temp.day_use_account = data.day_use_account[i];
                temp.month_use_account = data.month_use_account[i];
                temp.year_use_account = data.year_use_account[i];
                temp.utlization_ratio = data.utlization_ratio[i];
                result.push(temp);
            }
            if(!$("#UtilizationAnalysis").find(".Utilization").length > 0) {
                $("#UtilizationAnalysis").append("<div class='table Utilization'></div>");
            }
            var html = template('CrossAnalysisUtilization', {param: result});
            $(".Utilization" ).html(html);
        });
    }
</script>

<script type="application/javascript">
    function getCrossAnalysisByMonth() {
        $.get('../../cross_analysis/getCrossAnalysisByMonth', function (data) {
             console.log(data);
            if(!$("#CrossAnalysisByMonth").find(".temp").length > 0) {
                $("#CrossAnalysisByMonth").append("<div class='table temp'></div>");
            }
            var html = template('CrossAnalysis3', {param: data});
            $("#CrossAnalysisByMonth").find(".temp" ).html(html);
        });
    }
</script>

<script type="application/javascript">
function getCrossAnalysisByAcademyInUnderGraduate() {
    $.get('../../cross_analysis/getCrossAnalysisByAcademyInUnderGraduate', function (data) {
        for (var key in data) {
            if(!$("#crossAnalysisByMonthOfUnderGraduate").find(".key").length > 0) {
                $("#crossAnalysisByMonthOfUnderGraduate").append("<div style=\"text-align: center; font-size: 20px; margin-bottom: 20px\">" + key + "</div><div class='table " + key + "' style='margin-bottom: 20px'></div>");
            }
            var html = template('CrossAnalysis', {param: data[key]});
            $("#crossAnalysisByMonthOfUnderGraduate").find("." + key).html(html);
        }
    });
}

function getCrossAnalysisByAcademyInGraduate() {
    $.get('../../cross_analysis/getCrossAnalysisByAcademyInGraduate', function (data) {
        for (var key in data) {
            if(!$("#crossAnalysisByMonthOfGraduate").find(".key").length > 0) {
                $("#crossAnalysisByMonthOfGraduate").append("<div style=\"text-align: center; font-size: 20px; margin-bottom: 20px\">" + key + "</div><div class='table " + key + "' style='margin-bottom: 20px'></div>");
            }
            var html = template('CrossAnalysis', {param: data[key]});
            $("#crossAnalysisByMonthOfGraduate").find("." + key).html(html);
        }
    });
}
</script>

<script type="application/javascript">
    function ByAcademyInUnderGraduate(Colume,month) {
        var rank =0;
        var flag = 0;
        var res = new Array();
        $.get('../../cross_analysis/getCrossAnalysisByAcademyInUnderGraduate', function (data) {
            for(var key in data){
                // for(var i = 0; i < data[key].length; i++){
                //     if(data[key].month == month && data[key][i].)
                // }
                // res[flag++] = data[key].
            }
        });
        return rank;
    }
</script>

<script type="application/javascript">
    function sortByAcademyInGraduate(data){
        var rank = 0;

        return rank;
    }
</script>

<script type="application/javascript">
    function initYearSelection(){
        var date = new Date();
        var year = date.getFullYear(); //获取当前年份
        var month = date.getMonth() + 1; //获取当前月份
        if(month < 9) year = year - 1;
        $("#YearChosen").text(year);
        $("#Year1").text(year);
        year--;
        $("#Year2").text(year);
        year--;
        $("#Year3").text(year);
        year--;
        $("#Year4").text(year);
        $("ul").children().click(function () {
            var yearChosen = $(this).find("span").text();
            $("#YearChosen").text(yearChosen);
            CrossAnalysisByDay();
        });
    }
</script>

<script type="text/html" id="CrossAnalysis3">
    <table class="table-cyan" cellspacing="0" cellpadding="0" width="100%">
        <tr>
            <th>月份</th>
            <th>借阅次数</th>
            <th>进馆人数</th>
            <th>研修间人数</th>
            <th>电子阅览室人数</th>
            <th>座位人数</th>
            <th>打印次数</th>
        </tr>
        {{each param as p}}
        <tr>
            <td>{{p.month}}</td>
            <td>{{p.book_lend_times}}</td>
            <td>{{p.gctrl_times}}</td>
            <td>{{p.croom_times}}</td>
            <td>{{p.eread_times}}</td>
            <td>{{p.seat_times}}</td>
            <td>{{p.print_times}}</td>
        </tr>
        {{/each}}
    </table>
</script>

<script type="text/html" id="CrossAnalysis1">
    <table class="table-cyan" cellspacing="0" cellpadding="0" width="100%">
        <tr>
            <th>时段</th>
            <th>借阅次数</th>
            <th>进馆人数</th>
            <th>研修间人数</th>
            <th>电子阅览室人数</th>
            <th>座位人数</th>
            <th>打印次数</th>
        </tr>
        {{each param as p}}
        <tr>
            <td>{{p.hour}}:00-{{p.hour}}:59</td>
            <td>{{p.book_lend_times}}</td>
            <td>{{p.gctrl_times}}</td>
            <td>{{p.croom_times}}</td>
            <td>{{p.eread_times}}</td>
            <td>{{p.seat_times}}</td>
            <td>{{p.print_times}}</td>
        </tr>
        {{/each}}
    </table>
</script>

<script>
    template.helper('toFloat', function (data) {
        if( isNaN(data) || data == Infinity ) {
            return 0.00;
        }else{
            return parseFloat(data).toFixed(2)
        }
    })
</script>

<script type="text/html" id="CrossAnalysis">
    <table class="table-cyan" cellspacing="0" cellpadding="0" width="100%">
        <tr>
            <th>月份</th>
            <th>借阅次数(次/人均)</th>
            <th>进馆人数(次/人均)</th>
            <th>研修间(次/人均)</th>
            <th>电子阅览室(次/人均)</th>
            <th>座位数(次/人均)</th>
            <th>打印数(次/人均)</th>
        </tr>
        {{each param as p}}
        <tr>
            <td>{{p.month}}</td>
            <td>{{p.book_lend_times}}<span style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.book_lend_times/p.acdemy_stu_amount}}</td>
            <td>{{p.gctrl_times}}<span style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.gctrl_times/p.acdemy_stu_amount}}</td>
            <td>{{p.croom_times}}<span style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.croom_times/p.acdemy_stu_amount}}</td>
            <td>{{p.eread_times}}<span style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.eread_times/p.acdemy_stu_amount}}</td>
            <td>{{p.seat_times}}<span  style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.seat_times/p.acdemy_stu_amount}}</td>
            <td>{{p.print_times}}<span style=" font-size: 20px; font-weight: 300">&nbsp;/&nbsp;</span>{{toFloat p.print_times/p.acdemy_stu_amount}}</td>
        </tr>
        {{/each}}
    </table>
</script>

<script type="text/html" id="CrossAnalysisUtilization">
    <table class="table-cyan" cellspacing="0" cellpadding="0" width="100%">
        <tr>
            <th>类型</th>
            <th>日使用次数</th>
            <th>月使用次数</th>
            <th>年使用次数</th>
            <!--<th>利用率</th>-->
        </tr>
        {{each param as p}}
        <tr>
            <td>{{p.ic_type}}</td>
            <td>{{p.day_use_account}}</td>
            <td>{{p.month_use_account}}</td>
            <td>{{p.year_use_account}}</td>
            <!--<td>{{p.utlization_ratio}}%</td>-->
        </tr>
        {{/each}}
    </table>
</script>
</body>
</html>